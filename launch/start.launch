<!--
  Copyright (C) 2022-2023 Shadow Robot Company Ltd <software@shadowrobot.com>

  This program is free software; you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by
  the Free Software Foundation; either version 3 of the License, or
  (at your option) any later version.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.

  You should have received a copy of the GNU General Public License
  along with this program; if not, write to the Free Software
  Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA
-->

<launch>
  <!-- Polhemus suffers from hemispherical ambiguity, i.e. it cannot tell which side of the source a sensor is on. The
  x, y, and z_hs parameters are axes unit vectors that describe the central vector of the configured hemisphere. A bug
  in our polhemus wrapper implementation limits these parameters to being integers, but the vector is still normalised.
  The default values of [1, 0, 1] result in the hemisphere being tilted towards the fingertips by 45 deg, making thumb
  tip movements less likely to leave the hemisphere. -->
  <arg name="x_hs" default="1" />
  <arg name="y_hs" default="0" />
  <arg name="z_hs" default="1" />
  <arg name="hands" default="right"/>

  <arg name="sensors_right_glove" default="6" />
  <arg name="sensors_left_glove" default="6" />

  <arg name="product_type" default="viper"/>
  <arg name="node_name" default="polhemus_tf_broadcaster"/>
  <arg name="boresight_calibration_file_path" default="$(find polhemus_ros_driver)/config"/>
  <arg name="boresight_calibration_file_name" default="$(arg product_type)_calibration.yaml"/>
  <arg name="boresight_calibration_file" default="$(arg boresight_calibration_file_path)/$(arg boresight_calibration_file_name)"/>

  <arg name="tf_publish_topic" default="/tf_polhemus"/>  
  <arg name="start_driver" default="true"/>
  
  <group if="$(arg start_driver)">
    <node pkg="polhemus_ros_driver" type="polhemus_tf_broadcaster" name="$(arg node_name)" output="screen">
      <rosparam param="boresight_calibration_file" subst_value="True">$(arg boresight_calibration_file)</rosparam>
      <param name="x_hs" value="$(arg x_hs)" type="int"/>
      <param name="y_hs" value="$(arg y_hs)" type="int"/>
      <param name="z_hs" value="$(arg z_hs)" type="int"/>
      <param name="hands" value="$(arg hands)" type="string"/>
      <param name="sensors_right_glove" value="$(arg sensors_right_glove)" type="int"/>
      <param name="sensors_left_glove" value="$(arg sensors_left_glove)" type="int"/>
      <param name="product_type" value="$(arg product_type)" type="string"/>
      <remap from="/tf_polhemus" to="$(arg tf_publish_topic)"/>
    </node>
  </group>

  <rosparam command="load" file="$(arg boresight_calibration_file)" ns="$(arg node_name)"/>

  <node name="sr_knuckle_calibration" pkg="polhemus_ros_driver" type="knuckle_position_calibration_action_server.py" output="screen">
    <param name="side" value="$(arg hands)" type="string"/>
  </node>

</launch>
